From 1e212409ddfde445611c706c74340bc1f1239178 Mon Sep 17 00:00:00 2001
From: Mohaned Qunaibit <mohaned.qunaibit@oracle.com>
Date: Thu, 11 Jan 2024 15:47:48 +0300
Subject: [PATCH] patch 1.60.0

---
 pyproject.toml                    | 3 +++
 setup.py                          | 2 +-
 src/python/grpcio/grpc/_server.py | 4 ++--
 3 files changed, 6 insertions(+), 3 deletions(-)
 create mode 100644 pyproject.toml

diff --git a/pyproject.toml b/pyproject.toml
new file mode 100644
index 0000000..04749ec
--- /dev/null
+++ b/pyproject.toml
@@ -0,0 +1,3 @@
+[build-system]
+requires = ["setuptools >= 40.6.0", "wheel", "Cython < 3"]
+build-backend = "setuptools.build_meta:__legacy__"
diff --git a/setup.py b/setup.py
index 97c1dce..3a67bb9 100644
--- a/setup.py
+++ b/setup.py
@@ -135,7 +135,7 @@ BUILD_OVERRIDE_BORING_SSL_ASM_PLATFORM = os.environ.get(
 # to have been generated by building first *with* Cython support. Even if this
 # is set to false, if the script detects that the generated `.c` file isn't
 # present, then it will still attempt to use Cython.
-BUILD_WITH_CYTHON = _env_bool_value("GRPC_PYTHON_BUILD_WITH_CYTHON", "False")
+BUILD_WITH_CYTHON = _env_bool_value("GRPC_PYTHON_BUILD_WITH_CYTHON", "True")
 
 # Export this variable to use the system installation of openssl. You need to
 # have the header files installed (in /usr/include/openssl) and during
diff --git a/src/python/grpcio/grpc/_server.py b/src/python/grpcio/grpc/_server.py
index 5950561..d86796f 100644
--- a/src/python/grpcio/grpc/_server.py
+++ b/src/python/grpcio/grpc/_server.py
@@ -1167,12 +1167,12 @@ def _process_event_and_continue(
     state: _ServerState, event: cygrpc.BaseEvent
 ) -> bool:
     should_continue = True
-    if event.tag is _SHUTDOWN_TAG:
+    if event.tag == _SHUTDOWN_TAG:
         with state.lock:
             state.due.remove(_SHUTDOWN_TAG)
             if _stop_serving(state):
                 should_continue = False
-    elif event.tag is _REQUEST_CALL_TAG:
+    elif event.tag == _REQUEST_CALL_TAG:
         with state.lock:
             state.due.remove(_REQUEST_CALL_TAG)
             concurrency_exceeded = (
-- 
2.25.1

